# –¢–µ–ª–µ–≥—Ä–∞–º –ë–æ—Ç –æ—Ç –∫–∞–Ω–∞–ª–∞ 48/91 –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤ –∏ —Å–µ—Ä–∏–∞–ª–æ–≤

–≠—Ç–æ—Ç Telegram-–±–æ—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–∫–∞—Ç—å —Ñ–∏–ª—å–º—ã –∏ —Å–µ—Ä–∏–∞–ª—ã, –∞ —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è—Ç—å –∏—Ö –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ. –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –Ω–∏–∂–µ.

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–û–ø–∏—Å–∞–Ω–∏–µ](#–æ–ø–∏—Å–∞–Ω–∏–µ)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- [–ö–æ–º–∞–Ω–¥—ã](#–∫–æ–º–∞–Ω–¥—ã)
- [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#—Ç–µ—Ö–¥–æ–∫)

## –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –±–æ—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–∫–∞—Ç—å —Ñ–∏–ª—å–º—ã –∏ —Å–µ—Ä–∏–∞–ª—ã —á–µ—Ä–µ–∑ Telegram. –û–Ω –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç –ø–æ–∏—Å–∫ –ø–æ –¥–≤—É–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º:

- **LordSerial**: [https://lordserial.run/](https://lordserial.run/)
- **GoodFilms**: [https://zhqpg.goodfilms.fun/](https://zhqpg.goodfilms.fun/)

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞, –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ–∏–ª—å–º—ã –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –∏ –ø–æ–ª—É—á–∞—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–ª–µ–µ—Ä—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
    ```bash
    git clone https://github.com/your-username/your-repo.git
    cd your-repo
    ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
    ```bash
    pip install -r requirements.txt
    ```

3. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
    –í –∫–æ—Ä–Ω–µ–≤–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `config.json` –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à Telegram —Ç–æ–∫–µ–Ω:
    ```json
    {
        "TOKEN": "–í–ê–®_–¢–ï–õ–ï–ì–†–ê–ú_–¢–û–ö–ï–ù"
    }
    ```

4. **–°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:**
    –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö SQLite –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤:
    ```bash
    python -c "from bot import create_tables"
    ```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:**
    ```bash
    python bot.py
    ```

2. **–í Telegram –Ω–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ –ø–æ –µ–≥–æ –∏–º–µ–Ω–∏ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start`, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞.**

## –ö–æ–º–∞–Ω–¥—ã

- **`/start`** - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º.
- **–ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤ –∏ —Å–µ—Ä–∏–∞–ª–æ–≤** - –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞ –∏–ª–∏ —Å–µ—Ä–∏–∞–ª–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞.
- **–ò–∑–±—Ä–∞–Ω–Ω–æ–µ** - –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤.

### –ö–æ–º–∞–Ω–¥—ã –≤ –±–æ—Ç–µ

- **üîç –ü–æ–∏—Å–∫**: –ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫ —Ñ–∏–ª—å–º–∞ –∏–ª–∏ —Å–µ—Ä–∏–∞–ª–∞.
- **‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ**: –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–∑–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å–º—ã.
- **‚ñ∂Ô∏è –°–ú–û–¢–†–ï–¢–¨**: –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É —Ñ–∏–ª—å–º–∞.
- **‚≠ê –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ**: –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ.
- **üè† –ì–ª–∞–≤–Ω–∞—è**: –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.

# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ Telegram –±–æ—Ç—É –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤

## –í–≤–µ–¥–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã Telegram –±–æ—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤ –∏ —Å–µ—Ä–∏–∞–ª–æ–≤. –ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–∏—Å–∫ –ø–æ –¥–≤—É–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å–º–∞–º–∏. –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–∫–ª—é—á–∞—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å API, –ø–∞—Ä—Å–∏–Ω–≥ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü –∏ —Ä–∞–±–æ—Ç—É —Å SQLite –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- `config.json` ‚Äî –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å —Ç–æ–∫–µ–Ω–æ–º –±–æ—Ç–∞.
- `favorites.db` ‚Äî SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤.
- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç (`main.py`) ‚Äî –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –±–æ—Ç–∞.

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `telegram` ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Telegram API.
- `telegram.ext` ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å Telegram API.
- `requests` ‚Äî –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤.
- `beautifulsoup4` ‚Äî –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML.
- `sqlite3` ‚Äî –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å SQLite –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.
- `hashlib` ‚Äî –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤.

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

**–§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**

```python
with open('config.json', 'r') as file:
    config = json.load(file)
    TOKEN = config['TOKEN']
```

–¢–æ–∫–µ–Ω –±–æ—Ç–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ `config.json`.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**

```python
logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO)
logger = logging.getLogger(__name__)
```

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –∏ –æ—à–∏–±–æ–∫.

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**

```python
def get_db_connection():
    conn = sqlite3.connect('favorites.db')
    conn.row_factory = sqlite3.Row
    return conn
```

**–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü:**

```python
def create_tables():
    conn = get_db_connection()
    conn.execute('''
        CREATE TABLE IF NOT EXISTS user_favorites (
            chat_id INTEGER,
            title TEXT,
            url TEXT,
            player_url TEXT,
            PRIMARY KEY (chat_id, title)
        )
    ''')
    conn.close()
```

–¢–∞–±–ª–∏—Ü–∞ `user_favorites` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö

**–ó–∞–ø—Ä–æ—Å HTML-–∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**

```python
def get_page(url, params=None):
    response = requests.get(url, params=params)
    response.raise_for_status()
    logger.debug(f'HTML –∫–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {response.text[:1000]}')
    return response.text
```

**–ü–æ–∏—Å–∫ –Ω–∞ —Å–∞–π—Ç–µ lordserial:**

```python
def get_search_results_lordserial(search_term):
    params_lordserial = {'do': 'search', 'subaction': 'search', 'story': search_term}
    search_content_lordserial = get_page(SEARCH_URL_LORDSERIAL, params=params_lordserial)
    return parse_search_results_lordserial(search_content_lordserial)

def parse_search_results_lordserial(content):
    soup = BeautifulSoup(content, 'html.parser')
    results = []
    for item in soup.find_all('div', class_='th-item'):
        title = item.find('div', class_='th-title').get_text(strip=True)
        link = item.find('a', class_='th-in with-mask')['href']
        results.append((f"{title} (–ò—Å—Ç–æ—á–Ω–∏–∫ 1)", link))
    return results
```

**–ü–æ–∏—Å–∫ –Ω–∞ —Å–∞–π—Ç–µ goodfilms:**

```python
def get_search_results_goodfilms(search_term):
    params_goodfilms = {
        'do': 'search',
        'subaction': 'search',
        'story': search_term,
        'result_from': 1
    }
    search_content_goodfilms = requests.post(SEARCH_URL_GOODFILMS, data=params_goodfilms).text
    return parse_search_results_goodfilms(search_content_goodfilms)

def parse_search_results_goodfilms(content):
    soup = BeautifulSoup(content, 'html.parser')
    results = []
    for item in soup.find_all('div', class_='poster'):
        title = item.find('span', class_='poster__title').get_text(strip=True)
        link = item.find('a', class_='poster__link')['href']
        results.append((f"{title} (–ò—Å—Ç–æ—á–Ω–∏–∫ 2)", link))
    return results
```

**–û–±—â–∏–π –ø–æ–∏—Å–∫:**

```python
def get_search_results(search_term):
    results_lordserial = get_search_results_lordserial(search_term)
    results_goodfilms = get_search_results_goodfilms(search_term)
    return results_lordserial + results_goodfilms
```

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∏–ª—å–º–µ

**–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:**

```python
def extract_movie_info(movie_page_content, source):
    soup = BeautifulSoup(movie_page_content, 'html.parser')
    title = soup.find('h1')
    if source == 'goodfilms':
        description_div = soup.find('div', class_='pmovie__descr')
        description = description_div.find('div', class_='pmovie__text full-text clearfix') if description_div else None
        description_text = description.get_text(strip=True) if description else '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'
    else:
        description_div = soup.find('div', class_='fdesc')
        description_text = description_div.get_text(strip=True) if description_div else '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'
    title_text = title.get_text(strip=True) if title else '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'
    return {
        'title': title_text,
        'description': description_text,
    }
```

**–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–ª–µ–µ—Ä:**

```python
def extract_player_link(movie_page_content):
    soup = BeautifulSoup(movie_page_content, 'html.parser')
    iframe = soup.find('iframe')
    if iframe:
        src = iframe['src']
        if src.startswith('//'):
            src = 'https:' + src
        return src
    player_div = soup.find('div', class_='player-container')
    if player_div:
        player_link = player_div.find('a')
        if player_link and 'href' in player_link.attrs:
            href = player_link['href']
            if href.startswith('//'):
                href = 'https:' + href
            return href
    return None
```

### 5. –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ:**

```python
def build_keyboard(results, current_page, total_pages):
    keyboard = []
    start_index = (current_page - 1) * 5
    end_index = start_index + 5
    paginated_results = results[start_index:end_index]
    for idx, (title, _) in enumerate(paginated_results):
        keyboard.append([InlineKeyboardButton(title, callback_data=f"movie_{start_index + idx}")])
    if current_page > 1:
        keyboard.append([InlineKeyboardButton("‚¨ÖÔ∏è –ü—Ä–µ–¥—ã–¥—É—â–∞—è", callback_data=f'prev_{current_page - 1}')])
    if current_page < total_pages:
        keyboard.append([InlineKeyboardButton("–°–ª–µ–¥—É—é—â–∞—è ‚û°Ô∏è", callback_data=f'next_{current_page + 1}')])
    return InlineKeyboardMarkup(keyboard)

def build_favorites_keyboard():
    keyboard = [
        [InlineKeyboardButton("üè† –ì–ª–∞–≤–Ω–∞—è", callback_data='home')]
    ]
    return InlineKeyboardMarkup(keyboard)
```

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ñ–∏–ª—å–º–∞:**

```python
def build_movie_keyboard(movie_url, player_url, is_favorite=False):
    unique_id = get_unique_id(movie_url)
    keyboard = []
    if player_url:
        logger.debug(f'Player URL: {player_url}')
        keyboard.append([InlineKeyboardButton("‚ñ∂Ô∏è –°–ú–û–¢–†–ï–¢–¨", url=player_url)])
    else:
        keyboard.append([InlineKeyboardButton("‚ùì –ù–µ –Ω–∞–π–¥–µ–Ω –ø–ª–µ–µ—Ä", callback_data='none')])
    if is_favorite:
        keyboard.append([InlineKeyboardButton("‚úÖ –£–∂–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º", callback_data='none')])
    else:
        keyboard.append([InlineKeyboardButton("‚≠ê –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ", callback_data=f"favorite_{unique_id}")])
    keyboard.append([InlineKeyboardButton("üè† –ì–ª–∞–≤–Ω–∞—è", callback_data='home')])
    return InlineKeyboardMarkup(keyboard)
```

### 6. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π

**–ö–æ–º–∞–Ω–¥–∞ /start:**

```python
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    logger.info('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª /start')
    keyboard = [
        [InlineKeyboardButton("üîç –ü–æ–∏—Å–∫", callback_data='search')],
        [InlineKeyboardButton("‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ", callback_data='favorites')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    welcome_message = (
        "üé¨ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±–æ—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤ –∏ —Å–µ—Ä–∏–∞–ª–æ–≤ –æ—Ç –∫–∞–Ω–∞–ª–∞ <b>48/91</b> (https://t.me/tommorow4891)! üé¨\n\n"
        "–ù–∞–∂–º–∏—Ç–µ '–ü–æ–∏—Å–∫' –¥–ª—è –Ω–∞—á–∞–ª–∞."
    )
    if update.message:
        chat_id = update.message.chat_id
    else:
        chat_id = update.callback_query.message.chat_id
    await context.bot.send_message(
        chat_id=chat_id,
        text=welcome_message,
        reply_markup=reply_markup,
        parse_mode='HTML'
    )
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏:**

```python
async def button(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    data

 = query.data
    logger.info(f'–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ —Å –¥–∞–Ω–Ω—ã–º–∏: {data}')
    if data == 'search':
        await query.edit_message_text(text="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞ –∏–ª–∏ —Å–µ—Ä–∏–∞–ª–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞:")
    elif data == 'favorites':
        chat_id = update.callback_query.message.chat_id
        user_favorites = get_user_favorites(chat_id)
        if not user_favorites['favorites']:
            await query.edit_message_text('–ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å–º—ã –ø—É—Å—Ç—ã.', reply_markup=build_favorites_keyboard())
        else:
            favorites_message = '\n'.join([f"{idx + 1}. <a href='{user_favorites['links'][title]}'>{title}</a>"
                                           for idx, title in enumerate(user_favorites['favorites'])])
            await query.edit_message_text(f'–í–∞—à–∏ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å–º—ã:\n{favorites_message}', parse_mode='HTML',
                                          reply_markup=build_favorites_keyboard())
    elif data.startswith('movie_'):
        index = int(data.split('_')[1])
        results = search_results_cache.get('results', [])
        if 0 <= index < len(results):
            title, movie_url = results[index]
            source = 'goodfilms' if '–ò—Å—Ç–æ—á–Ω–∏–∫ 2' in title else 'lordserial'
            movie_page_content = get_page(movie_url)
            movie_info = extract_movie_info(movie_page_content, source)
            player_url = extract_player_link(movie_page_content)
            chat_id = update.callback_query.message.chat_id
            conn = get_db_connection()
            cursor = conn.execute('SELECT 1 FROM user_favorites WHERE chat_id = ? AND url = ?', (chat_id, movie_url))
            is_favorite = cursor.fetchone() is not None
            conn.close()
            response_message = (
                f"<b>–ù–∞–∑–≤–∞–Ω–∏–µ:</b> {movie_info['title']}\n"
                "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n"
                f"<b>–û–ø–∏—Å–∞–Ω–∏–µ:</b>\n<i>{movie_info['description']}</i>\n"
                "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n"
            )
            await query.edit_message_text(
                text=response_message,
                parse_mode='HTML',
                reply_markup=build_movie_keyboard(movie_url, player_url, is_favorite)
            )
    elif data.startswith('favorite_'):
        unique_id = data.split('_')[1]
        movie_url = search_results_cache.get('url_map', {}).get(unique_id, '')
        chat_id = update.callback_query.message.chat_id
        if movie_url:
            movie_page_content = get_page(movie_url)
            player_url = extract_player_link(movie_page_content)
            if player_url:
                movie_info = extract_movie_info(movie_page_content, 'goodfilms')
                conn = get_db_connection()
                conn.execute('''INSERT OR IGNORE INTO user_favorites (chat_id, title, url, player_url)
                                VALUES (?, ?, ?, ?)''', (chat_id, movie_info['title'], movie_url, player_url))
                conn.commit()
                conn.close()
                await query.answer("–§–∏–ª—å–º –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ.", show_alert=True)
                await query.edit_message_reply_markup(reply_markup=build_movie_keyboard(movie_url, player_url, True))
        else:
            await query.answer("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.", show_alert=True)
    elif data == 'home':
        await start(update, context)
    elif data.startswith('next_') or data.startswith('prev_'):
        current_page = int(data.split('_')[1])
        results = search_results_cache.get('results', [])
        total_pages = search_results_cache.get('total_pages', 1)
        await query.edit_message_reply_markup(reply_markup=build_keyboard(results, current_page, total_pages))
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–ø–æ–∏—Å–∫):**

```python
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    search_term = update.message.text
    chat_id = update.message.chat_id
    results = get_search_results(search_term)
    search_results_cache['results'] = results
    search_results_cache['url_map'] = {get_unique_id(url): url for _, url in results}
    total_pages = (len(results) + 4) // 5
    search_results_cache['total_pages'] = total_pages
    if not results:
        await context.bot.send_message(chat_id=chat_id, text="–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.")
    else:
        await context.bot.send_message(chat_id=chat_id, text="–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞:",
                                       reply_markup=build_keyboard(results, current_page=1, total_pages=total_pages))
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**

```python
async def error(update: Update, context: ContextTypes.DEFAULT_TYPE):
    logger.error('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', exc_info=context.error)
```

### 7. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```python
if __name__ == '__main__':
    application = Application.builder().token(TOKEN).build()
    application.add_handler(CommandHandler('start', start))
    application.add_handler(CallbackQueryHandler(button))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    application.add_error_handler(error)
    application.run_polling()
```
